alertmanager:
  enabled: true
  alertmanagerSpec:

    replicas: 1

grafana:
  enabled: true
  replicaCount: 1

  serviceAccount:
    create: true
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::177716289679:role/eks-grafana-cloudwatch
  # 퍼시스턴트 볼륨 설정: Grafana 대시보드와 설정을 재시작해도 유지
  persistence:
    enabled: true
    size: 1Gi
    # storageClassName은 환경에 맞게 설정 (gp2, gp3 등)
    storageClassName: gp2

  sidecar:
    dashboards:
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      folder: /tmp/dashboards
      searchNamespace: ALL
      provider:
        allowUiUpdates: true
    datasources:
      enabled: true
      label: grafana_datasource
      labelValue: "1"


  additionalDataSources:
.
    - name: CloudWatch-RDS

      isDefault: false
      type: cloudwatch
      access: proxy
      jsonData:
        authType: default
        defaultRegion: ap-northeast-2

      uid: cloudwatch-rds
      editable: true
  env:
    GF_INSTALL_PLUGINS: ""
    AWS_SDK_LOAD_CONFIG: "true"
    AWS_DEFAULT_REGION: ap-northeast-2
  
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80},{"HTTPS":443}]'
      alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=60
      alb.ingress.kubernetes.io/group.order: "10"
      alb.ingress.kubernetes.io/group.name: observability
    hosts:
      - grafana.izza-nopizza.com
    paths:
      - /grafana
    pathType: Prefix

  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: workload
                operator: In
                values:
                  - system

prometheus:
  enabled: true
  prometheusSpec:
    serviceMonitorSelectorNilUsesHelmValues: false
    # prometheusSpec 하위에는 replicaCount가 아니라 replicas 입니다. 수정했습니다.
    replicas: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 200m
        memory: 256Mi
    retention: 10d
    retentionSize: 20GiB
    scrapeInterval: 30s
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 5Gi
          storageClassName: gp2
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
              - key: workload
                operator: In
                values:
                  - system
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80},{"HTTPS":443}]'
      alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=60
      alb.ingress.kubernetes.io/group.order: "10"
      alb.ingress.kubernetes.io/group.name: observability
    hosts:
      - prometheus.izza-nopizza.com
    paths:
      - /
    pathType: Prefix